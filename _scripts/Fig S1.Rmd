---
title: "Figure S1"
author: "Leslie Roberson"
date: "28/01/2022"
output: html_document
---

## Summary

This is the data and code needed to reproduce the raw version of Supplementary Figure 1 (average target and bycatch of vessels over the time period of the data, with one facet for each species/fishery interaction). This is the same as the main text Figure 1 but with each species fishery interaction in its own facet. 

Note that final formatting (fonts, bycatch species icons) was done in Adobe Illustrator.

```{r setup, include=FALSE}

library(tidyverse)
library(pillar)
library(here)
library(stringr)
library(cowplot)
library(ggrepel)
library(scales)
library(plotrix)
library(ggthemes)

knitr::opts_chunk$set(echo = TRUE)
```

## prep data

```{r aggregate data}

figS1.dat <- read_csv(here("_data/figS1_dat.csv")) # not publicly available
glimpse(figS1.dat)
# shot_id: anonymous ID of fishing event (setting and hauling gear)
# target_catch: count or weight(kg) of main target species, depending on the fishery
# bycatch_spp: one of eight bycatch species or groups
# bycatch_cnt: bycatch count (individual animals) 
# fishery: name of fishery as used in teh manuscripts (not the fishery's official name)
# vessel_id: anonymised identifier for individual vessels

figS1.dat.v2 <- figS1.dat %>%
    distinct(fishery, vessel_id, shot_id, target_catch, bycatch_spp, bycatch_cnt) %>%
    group_by(fishery, vessel_id, bycatch_spp) %>%
    summarise(avg_target = mean(target_catch),
              se_target= plotrix::std.error(target_catch),
              avg_bycatch = mean(bycatch_cnt),
              se_bycatch = plotrix::std.error(bycatch_cnt)) %>%
  ungroup()

write_csv(figS1.dat.v2, here("_data/figS1_dat_v2.csv"))

```

## prep data for plot

```{prep to plot}

figS1.dat.v2 <- read_csv(here("_data/figS1_dat_v2.csv"))

##<>< Make factors

# fishery
unique(figS1.dat.v2$fishery)
figS1.dat.v2$fishery <- as_factor(figS1.dat.v2$fishery)
figS1.dat.v2 <- figS1.dat.v2 %>%
  # reorder levels so the 3 SESSF subsectors are on top and the other 2 fisheries on the bottom
  mutate(fishery=fct_relevel(fishery, levels=c("set_gillnets", "demersal_longlines",  "otter_bottom_trawl", "tuna_longlines", "prawn_trawl"))) # ignore warning

# bycatch type
unique(figS1.dat.v2$bycatch_spp)
figS1.dat.v2$bycatch_spp <- as_factor(figS1.dat.v2$bycatch_spp)
figS1.dat.v2 <- figS1.dat.v2 %>%
  mutate(bycatch_spp = stringr::str_to_sentence(bycatch_spp)) %>%
  mutate(bycatch_spp=fct_recode(bycatch_spp, "Shortfin makos"="Shortfin_makos"),
         # put in alphabetical order
         bycatch_spp=fct_relevel(bycatch_spp,                                         levels=c("Albatrosses","Dolphins","Hammerheads","Petrels","Pinnipeds","Seasnakes","Shearwaters","Shortfin makos")))

##<>>< make color palette
pal_distinct8 <- c("#0073D2FF","#8F7700FF","#7876B1FF","#61221a","#CD534CFF","#272928","#EFC000FF","#868686FF")

```

## make plot
16 panel plot

```{r make plot}

figS1.plot <- figS1.dat.v2 %>%
    ggplot(aes(x=avg_target, y=avg_bycatch, color=bycatch_spp)) +
    geom_errorbar(aes(x=avg_target, y=avg_bycatch, ymin=avg_bycatch-se_bycatch, ymax=avg_bycatch+se_bycatch, color=bycatch_spp),
                  alpha = 0.8, size=0.2) +
    geom_errorbar(aes(x=avg_target, y=avg_bycatch, xmin=avg_target-se_target, xmax=avg_target+se_target, color=bycatch_spp),
                  alpha = 0.8, size=0.2) +
    geom_jitter(aes(color=bycatch_spp),
               alpha=0.8, pch=1) +
    scale_color_manual(values = pal_distinct8) +
    facet_wrap(~fishery + bycatch_spp,scales= "free") + 
    scale_x_continuous(expand=c(0.1, 0.1)) +
    scale_y_continuous(expand=c(0.05, 0)) +
    labs(x = "Average target catch per vessel (individuals or kg)", y = "Average bycatch per vessel (individuals)") +
    guides(color="none") + # hide legend because it's already labeled 
    theme(panel.grid = element_blank(),
          panel.background = element_rect(fill = NA, color = "black"),
          strip.text.x = element_text(margin = margin(2, 0, 2, 0), size=8)
          )

figS1.plot

```

